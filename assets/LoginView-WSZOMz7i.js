import{d as y,r as l,w as b,c as _,e as C,a as s,t as S,k as V,l as L,S as U,m as k,n as f,v as m,q as B,o as w,s as P,i as N,_ as T}from"./index-dS6pHrpw.js";const $={key:0},q={class:"login-container"},F={class:"login-content"},I=["disabled"],M=["disabled"],j=["disabled"],A=["disabled"],D=y({__name:"LoginView",setup(E){const u=N(),h=B(),r=l(""),n=l(""),d=l("");let p,o;const a=l(!1),v=l(!1),i=l();function g(){if(p=void 0,o=void 0,v.value=!1,n.value.length==0)return;const e=r.value.split("@");if(e.length!=2)return;let t;try{t=new URL("https://"+e[1])}catch{return}p=e[0],o=t,v.value=!0}async function x(){if(!p||!o||!n.value||a.value)return;if(!u){i.value="App instance is undefined";return}a.value=!0;const c={username_or_email:p,password:n.value};d.value.length>0&&(c.totp_2fa_token=d.value);const e=new P.LemmyHttp(o.origin);try{const t=await e.login(c);t.jwt?(e.setHeaders({Authorization:`Bearer ${t.jwt}`}),u.appContext.config.globalProperties.$client=e,u.appContext.config.globalProperties.$instanceUrl.value=o,u.appContext.config.globalProperties.$localSite.value=await e.getSite(),h.push("/")):i.value="Server didn't return JWT"}catch(t){i.value=t+""}a.value=!1}return b(()=>r.value,()=>g()),b(()=>n.value,()=>g()),(c,e)=>(w(),_("main",null,[i.value?(w(),_("p",$,S(i.value),1)):C("",!0),s("div",q,[V(U,{class:"login-box"},{content:L(()=>[s("div",F,[e[5]||(e[5]=s("h1",null,"Login",-1)),s("form",{class:"login-form",onSubmit:[x,e[3]||(e[3]=k(()=>{},["prevent"]))]},[s("span",null,[e[4]||(e[4]=s("div",{class:"user-field-at"},"@",-1)),f(s("input",{class:"user-field","onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),type:"username",placeholder:"me@example.com",required:"",disabled:a.value},null,8,I),[[m,r.value]])]),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.value=t),type:"password",placeholder:"Password",required:"",disabled:a.value},null,8,M),[[m,n.value]]),f(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t),type:"text",placeholder:"TOTP (if needed)",disabled:a.value},null,8,j),[[m,d.value]]),s("input",{type:"submit",value:"Log in",disabled:!v.value||a.value},null,8,A)],32)])]),_:1})])]))}}),R=T(D,[["__scopeId","data-v-6158bffd"]]);export{R as default};
